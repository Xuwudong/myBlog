---
title: redis
date: 2022-11-17 20:17:32
tags:
- redis 
- 中间件
- 缓存
categories:
- redis
---
* redis集群的master选举机制 
  首先会从哨兵集群中选举出来一个master作用于集群中的主备切换，哨兵自身选举算法为raft算法。
    * 当redis集群中的master因为某些原因挂掉的时候，此时如果该master下有多个slave，怎么确定哪一个可以晋为master，在此master的选举是有条件的
      1. 和master断开的时间，如果副本与主服务器断开连接的时间超过已配置主服务器超时的十倍，该slave不会成为master
      2. 每个slave都是有优先级的，会优先选举优先级比较高的，redis.conf中配置的replica-priority
      3. 其次当优先级一致的情况下，会选举数据同步最多的。
      4. 当上述两个条件均满足的时候，哪一个节点最先启动，优先成为master（slaves中runid最小的）



### HashTag用户自定义散列key
使用不当容易产生数据倾斜和访问热点

为什么用skiplist 不用红黑树实现zset，因为skiplist实现比较简单


* 缓存穿透指的是数据库本就没有这个数据，请求直奔数据库，缓存系统形同虚设。
    * 给不存在的数据也设置缓存，值为空
* 缓存击穿(失效)指的是数据库有数据，缓存本应该也有数据，但是缓存过期了，Redis 这层流量防护屏障被击穿了，请求直奔数据库。
    * 访问db加锁，保证只有一个请求到db,没有获取锁的等待一会再获取数据
* 缓存雪崩指的是大量的热点数据无法在 Redis 缓存中处理(大面积热点数据缓存失效、Redis 宕机)，流量全部打到数据库，导致数据库极大压力。
    * 缓存设置随机值
    * db开启连接限流
    * 构建高可用缓存系统